# Layer 1: Ingestion & Structural Understanding
structural_scan_task:
  description: >
    CALL the Structure Extractor tool with folder_path="{folder_path}" to read ALL source files.

    Your goal is to create a ground truth map of the codebase.

    Output JSON with:
    - language_detected
    - files (list with path, classes, functions, imports)
    - entry_points (main classes, bootstrap files)
    - public_interfaces (exported classes, public methods)
  expected_output: >
    Detailed JSON with language, all files, classes, functions, and imports.
    Output ONLY valid JSON - nothing else.
  agent: structural_scanner

dependency_analysis_task:
  description: >
    Using the structural scan, map all import/dependency relationships.

    Output JSON with:
    - modules (list with name, files, imports_from, imports_to)
    - external_dependencies (third-party libraries)
    - core_modules (most referenced modules)
  expected_output: >
    JSON with module dependencies, external libs, and core modules.
    Output ONLY valid JSON - nothing else.
  agent: dependency_analyzer

# Layer 2: Semantic Understanding
api_semantics_task:
  description: >
    Using the structural analysis, infer purpose of all APIs.

    For each API endpoint, determine:
    - purpose (what it does)
    - parameters (what it accepts)
    - returns (what it produces)
    - confidence_score (0.0-1.0)

    Output JSON with:
    - api_semantics (list with endpoint, purpose, params, returns, confidence)
  expected_output: >
    JSON with API purposes, parameters, returns, and confidence scores.
    Output ONLY valid JSON - nothing else.
  agent: api_semantics_agent

architecture_reasoning_task:
  description: >
    Using the structural and dependency analysis, explain the architecture.

    Output JSON with:
    - architectural_patterns (MVC, microservices, etc.)
    - component_roles (controller, service, repository, etc.)
    - data_flow (how requests travel through the system)
    - module_relationships (how modules connect)
  expected_output: >
    JSON with architecture patterns, components, data flow, and relationships.
    Output ONLY valid JSON - nothing else.
  agent: architecture_reasoning_agent

# Layer 3: Documentation Assembly
api_documentation_task:
  description: >
    Using the API semantics, generate structured API reference in MARKDOWN format.

    For each endpoint include:
    - Method and full path
    - Description
    - Parameters (name, type, required, description)
    - Request body (if applicable)
    - Response (status codes, body schema)
    - Security (roles required)
    - Example curl command

    Output format: Clean MARKDOWN with tables and code blocks.
  expected_output: >
    MARKDOWN API reference with all endpoints, parameters, examples.
    Output ONLY valid MARKDOWN - nothing else.
  agent: api_doc_agent

architecture_documentation_task:
  description: >
    Using the architecture reasoning, generate architecture overview in MARKDOWN format.

    Include:
    - System overview
    - Component diagram (text-based)
    - Module descriptions
    - Data flow explanation
    - Design patterns used

    Output format: Clean MARKDOWN with headers and diagrams.
  expected_output: >
    MARKDOWN architecture overview with components, flow, and patterns.
    Output ONLY valid MARKDOWN - nothing else.
  agent: architecture_doc_agent

examples_generation_task:
  description: >
    Using the API documentation, generate runnable code examples in MARKDOWN format.

    For each major API include:
    - Prerequisites (what to import/install)
    - Setup code (configuration)
    - Example usage (with realistic data)
    - Expected output

    Output format: MARKDOWN with fenced code blocks.
  expected_output: >
    MARKDOWN with runnable examples for all major APIs.
    Output ONLY valid MARKDOWN - nothing else.
  agent: example_generator_agent

getting_started_task:
  description: >
    Generate getting started guide in MARKDOWN format.

    Include:
    - Prerequisites
    - Installation steps
    - Configuration
    - Quick start example
    - Environment variables
    - Running the application

    Output format: Clean MARKDOWN tutorial.
  expected_output: >
    MARKDOWN getting started guide with setup and quick start.
    Output ONLY valid MARKDOWN - nothing else.
  agent: getting_started_agent

# Layer 6: Evaluation & Quality
quality_evaluation_task:
  description: >
    Evaluate the generated documentation.

    Report:
    - coverage_percent (what % of code is documented)
    - accuracy_score (how accurate vs source)
    - missing_endpoints (APIs not documented)
    - confidence_assessment (overall quality)
    - improvement_recommendations

    Output JSON with all metrics.
  expected_output: >
    JSON with coverage, accuracy, missing endpoints, and recommendations.
    Output ONLY valid JSON - nothing else.
  agent: evaluation_agent

# Layer 4: Final Assembly
final_assembly_task:
  description: >
    Combine all previous task outputs into a comprehensive final MARKDOWN document.

    Use the context from all previous tasks to create:

    1. **Analysis Summary**
       - Brief overview of what was analyzed
       - Key findings from structural scan and dependency analysis

    2. **Architecture Reasoning**
       - Detailed architectural patterns and component roles
       - How modules relate and data flows through the system
       - Design patterns identified

    3. **API Reference**
       - All endpoints with methods, paths, parameters, security
       - Include examples from the example_generator_agent output

    4. **Usage Examples**
       - Practical code examples showing how to use the APIs
       - Include curl commands and request/response examples

    5. **Getting Started Guide**
       - Prerequisites, installation, configuration
       - Quick start example to run the application

    Output format: Clean MARKDOWN with proper headers, tables, and code blocks.
  expected_output: >
    Comprehensive MARKDOWN document with:
    - Analysis Summary section
    - Architecture Reasoning section (detailed)
    - API Reference section
    - Usage Examples section
    - Getting Started Guide section
    Output ONLY valid MARKDOWN - nothing else.
  agent: documentation_assembler
